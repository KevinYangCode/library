<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>图书卡片（模板引擎）</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <link rel="stylesheet" href="/css/bookCard.css" media="all">
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset class="layui-elem-field layuimini-search">
            <legend>搜索信息</legend>
            <div style="margin: 10px 10px 10px 10px">
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">图书名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="name" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">类型</label>
                            <div class="layui-input-inline">
                                <select name="classId" id="search_classid" lay-filter="classifys">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <a class="layui-btn" lay-submit="" lay-filter="doSerach">搜索</a>
                        </div>
                    </div>
                </form>
            </div>
        </fieldset>

        <div class="layui-fluid layuimini-booklist-fluid">
            <div id="bookView" class="layui-row layui-col-space15"></div>
        </div>
        <div id="bookCardPage" style="text-align: center"></div>
    </div>
</div>
<script src="/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script id="bookList" type="text/html">
    {{# layui.each(d.data, function(index, item){ }}
    <div class="layui-col-md4 layui-col-sm6 layui-col-lg3">
        <div class="layuimini-contact-box">
            <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                <a href="javascript:;">
                    <div class="layuimini-book_img">
                        <img src="{{ item.pic }}">
                    </div>
                </a>
            </div>
            <div class="layui-col-md6 layui-col-sm6 layui-col-xs6 layuimini-padding-left20">
                <a href="javascript:;">
                    <h3 class="layuimini-title">
                        <strong>{{ item.name }}</strong>
                    </h3>
                    <p class="layuimini-textimg">
                        <i class="layui-icon layui-icon-location"></i>
                        {{ item.location}}
                    </p>
                    <p class="layuimini-textimg">
                        <i class="layui-icon layui-icon-note layuimini-font-blod"></i>
                        {{ item.classId}}
                    </p>
                </a>
                <div class="layui-btn-group">
                    <button class="layui-btn data-add-btn">添加</button>
                    <button class="layui-btn layui-btn-danger data-delete-btn">删除</button>
                </div>
            </div>
        </div>
    </div>
    {{# }); }}
    {{# if(d.data.length === 0){ }}
    无数据
    {{# } }}
</script>
<script>
    var datas;
    layui.use(['form', 'laypage', 'laytpl', 'jquery'], function () {
        var form = layui.form,
            laypage = layui.laypage,
            laytpl = layui.laytpl;
        $ = layui.jquery;
        var counts = 100;

        laypage.render({
            elem: 'bookCardPage'
            , count: counts // TODO 条数通过上面获取不了，待解决
            , limit: 12
            , groups: 3
            , first: false
            , last: false
            , jump: function (obj) {
                //obj包含了当前分页的所有参数，比如：
                var data = bookcard(obj);
                counts = data.count;
                var getTpl = bookList.innerHTML;
                var view = document.getElementById('bookView');
                laytpl(getTpl).render(data, function (html) {
                    view.innerHTML = html;
                });
            }
        });

        //初始化查询条件的下拉列表
        $.get("/classify", function (objs) {
            var types = objs.data;
            var search_classid = $("#search_classid");
            $.each(types, function (index, item) {
                search_classid.append("<option value=" + item.classId + ">" + item.className + "</option>");
            });
            form.render("select");
        });

        //模糊查询
        form.on("submit(doSerach)", function (data) {

            return false;
        });

    });

    function bookcard(obj) {
        $.ajax({
            url: "/book/page",
            type: "GET",
            async: false,
            data: {"current": obj.curr, "size": obj.limit},
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                datas = data;
            },
        });
        return datas;
    }
</script>
</body>
</html>