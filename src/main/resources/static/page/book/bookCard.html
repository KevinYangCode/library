<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>图书卡片（模拟渲染）</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <link rel="stylesheet" href="/css/bookCard.css" media="all">
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <fieldset class="layui-elem-field layuimini-search">
            <legend>搜索信息</legend>
            <div style="margin: 10px 10px 10px 10px">
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">图书名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="name" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">类型</label>
                            <div class="layui-input-inline">
                                <select name="classId" id="search_classid" lay-filter="classifys">
                                    <option value=""></option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <a class="layui-btn" lay-submit="" lay-filter="doSerach">搜索</a>
                        </div>
                    </div>
                </form>
            </div>
        </fieldset>
        <div class="layui-fluid layuimini-booklist-fluid">
            <div id="bookView" class="layui-row layui-col-space15"></div>
        </div>
        <div id="bookCardPage" style="text-align: center"></div>
    </div>
</div>
<script src="/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script id="bookList" type="text/html">
    {{# layui.each(d.data, function(index, item){ }}
    <div class="layui-col-md4 layui-col-sm6 layui-col-lg3">
        <div class="layuimini-contact-box">
            <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                <a href="javascript:;">
                    <div class="layuimini-book_img">
                        <img src="{{ item.pic }}">
                    </div>
                </a>
            </div>
            <div class="layui-col-md6 layui-col-sm6 layui-col-xs6 layuimini-padding-left20">
                <a href="javascript:;">
                    <h3 class="layuimini-title">
                        <strong>{{ item.name }}</strong>
                    </h3>
                    <p class="layuimini-textimg">
                        <i class="layui-icon layui-icon-location"></i>
                        {{ item.location}}
                    </p>
                    <p class="layuimini-textimg">
                        <i class="layui-icon layui-icon-note layuimini-font-blod"></i>
                        {{ item.classId}}
                    </p>
                </a>
                <div class="layui-btn-group">
                    <button class="layui-btn data-add-btn">添加</button>
                    <button class="layui-btn layui-btn-danger data-delete-btn">删除</button>
                </div>
            </div>
        </div>
    </div>
    {{# }); }}
    {{# if(d.data.length === 0){ }}
    无数据
    {{# } }}
</script>
<script>
    layui.use(['form', 'laypage', 'jquery'], function () {
        var form = layui.form,
            laypage = layui.laypage;
        $ = layui.jquery;
        var datas = bookcardAll();
        initPage();
        //模糊查询
        form.on("submit(doSerach)", function (data) {
            var conditions = data.field;
            console.log(conditions);
            datas = bookcardAll(conditions);
            initPage();
            return false;
        });

        function initPage() {
            laypage.render({
                elem: 'bookCardPage'
                , count: datas.length
                , limit: 6
                , groups: 3
                , first: false
                , last: false
                , jump: function (obj) {
                    //模拟渲染
                    document.getElementById('bookView').innerHTML = function () {
                        var arr = []
                            , thisData = datas.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
                        layui.each(thisData, function (index, item) {
                            arr.push('<div class="layui-col-md4 layui-col-sm6 layui-col-lg3">');
                            arr.push('<div class="layuimini-contact-box">');
                            arr.push('<div class="layui-col-md6 layui-col-sm6 layui-col-xs6">');
                            arr.push('<a href="javascript:;">');
                            arr.push('<div class="layuimini-book_img">');
                            arr.push("<img src='" + item.pic + "'>");
                            arr.push('</div>');
                            arr.push('</a>');
                            arr.push('</div>');
                            arr.push('<div class="layui-col-md6 layui-col-sm6 layui-col-xs6 layuimini-padding-left20">');
                            arr.push('<a href="javascript:;">');
                            arr.push('<h3 class="layuimini-title">');
                            arr.push('<strong>' + item.name + '</strong>');
                            arr.push('</h3>');
                            arr.push('<p class="layuimini-textimg">');
                            arr.push('<i class="layui-icon layui-icon-location"></i>');
                            arr.push(' ' + item.locationName);
                            arr.push('</p>');
                            arr.push('<p class="layuimini-textimg">');
                            arr.push('<i class="layui-icon layui-icon-note layuimini-font-blod"></i>');
                            arr.push(' ' + item.className);
                            arr.push('</p>');
                            arr.push('</a>');
                            arr.push('<div class="layui-btn-group">');
                            arr.push('<button class="layui-btn data-add-btn">添加</button>');
                            arr.push('<button class="layui-btn layui-btn-danger data-delete-btn">删除</button>');
                            arr.push('</div></div></div></div>');
                        });
                        if (thisData.length === 0) {
                            arr.push('无数据！')
                        }
                        return arr.join('');
                    }();
                }
            });
        }

        //初始化查询条件的下拉列表
        $.get("/classify", function (objs) {
            var types = objs.data;
            var search_classid = $("#search_classid");
            $.each(types, function (index, item) {
                search_classid.append("<option value=" + item.classId + ">" + item.className + "</option>");
            });
            form.render("select");
        });

    });
    var datas;

    function bookcardAll(conditions) {
        $.ajax({
            url: "/book",
            type: "GET",
            async: false,
            data: conditions,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                datas = data.data;
            },
        });
        return datas;
    }
</script>
</body>
</html>